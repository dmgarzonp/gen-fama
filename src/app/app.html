<div class="h-screen w-screen bg-[#f8faf9] text-gray-800 flex" *ngIf="showSidebar()">
  <aside
    class="bg-emerald-700 text-white flex flex-col h-screen shadow-lg transition-[width] duration-200"
    [class.w-64]="!sidebarCollapsed()"
    [class.w-24]="sidebarCollapsed()"
  >
    <div
      class="h-16 flex items-center px-4 border-b border-emerald-600"
      [class.justify-between]="!sidebarCollapsed()"
      [class.justify-center]="sidebarCollapsed()"
    >
      <div
        class="flex items-center gap-2"
        [class.gap-0]="sidebarCollapsed()"
      >
        <lucide-icon
          name="pill"
          class="text-emerald-50"
          [class.w-6]="!sidebarCollapsed()"
          [class.h-6]="!sidebarCollapsed()"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-lg font-semibold tracking-tight transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Gen-farma
        </span>
      </div>
    </div>
    <nav class="flex-1 px-2 py-4 space-y-1 text-sm">
      <a
        routerLink="/dashboard"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="layout-dashboard"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Dashboard
        </span>
      </a>
      <a
        routerLink="/pos"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="shopping-cart"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          POS
        </span>
      </a>
      <a
        routerLink="/products/inventory"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="package"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Inventario
        </span>
      </a>
      <a
        routerLink="/caja"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="wallet"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Caja
        </span>
      </a>
      <a
        routerLink="/clientes"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="users"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Clientes
        </span>
      </a>
      <a
        routerLink="/compras/proveedores"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="file-text"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Proveedores
        </span>
      </a>
      <a
        routerLink="/compras/ordenes"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="truck"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Compras
        </span>
      </a>
      <a
        routerLink="/reportes"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="bar-chart"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Reportes
        </span>
      </a>
      <a
        routerLink="/controlados/libro"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="book-lock"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Controlados
        </span>
      </a>
      <a
        *ngIf="currentUser()?.role === 'admin'"
        routerLink="/users"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="user"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Usuarios
        </span>
      </a>
      <a
        routerLink="/settings"
        routerLinkActive="bg-emerald-600 text-white"
        class="flex items-center px-3 py-2 rounded-lg text-emerald-50 hover:bg-emerald-600 transition-colors"
        [class.gap-4]="!sidebarCollapsed()"
        [class.gap-0]="sidebarCollapsed()"
        [class.justify-center]="sidebarCollapsed()"
      >
        <lucide-icon
          name="settings"
          class="text-emerald-50"
          [class.w-5]="sidebarCollapsed()"
          [class.h-5]="sidebarCollapsed()"
          [class.w-4]="!sidebarCollapsed()"
          [class.h-4]="!sidebarCollapsed()"
        ></lucide-icon>
        <span
          class="text-sm md:text-[0.95rem] font-medium transition-opacity duration-150"
          [class.opacity-0]="sidebarCollapsed()"
          [class.w-0]="sidebarCollapsed()"
          [class.overflow-hidden]="sidebarCollapsed()"
        >
          Configuraci√≥n
        </span>
      </a>
    </nav>
  </aside>

  <main class="flex-1 flex flex-col">
    <header class="h-16 bg-white/80 backdrop-blur border-b border-gray-200 flex items-center justify-between px-6">
      <div class="flex items-center gap-3">
        <button
          type="button"
          class="p-2.5 rounded-lg hover:bg-gray-100 text-emerald-700 transition-colors border border-transparent hover:border-gray-200"
          (click)="sidebarCollapsed.set(!sidebarCollapsed())"
        >
          <lucide-icon name="menu" class="w-5 h-5"></lucide-icon>
        </button>
        <h1 class="text-lg font-medium text-gray-800">{{ title() }}</h1>
      </div>
      <div class="flex items-center gap-4">
        <div *ngIf="currentUser()" class="flex items-center gap-2 text-sm text-gray-700">
          <lucide-icon name="user" class="w-4 h-4"></lucide-icon>
          <span class="font-medium">{{ currentUser()?.nombre }}</span>
          <span class="text-gray-500">({{ currentUser()?.role }})</span>
        </div>
        <button
          *ngIf="currentUser()"
          type="button"
          (click)="logout()"
          class="flex items-center gap-2 px-3 py-1.5 text-sm text-red-600 hover:bg-red-50 rounded-lg transition-colors"
        >
          <lucide-icon name="power" class="w-4 h-4"></lucide-icon>
          <span>Salir</span>
        </button>
      </div>
    </header>
    <section class="flex-1 overflow-auto p-4 md:p-6">
      <router-outlet />
    </section>
  </main>
</div>

<!-- Vista sin sidebar para login -->
<div class="h-screen w-screen" *ngIf="!showSidebar()">
  <router-outlet />
</div>

<!-- Toast Notifications (Global) -->
<app-toast-notification></app-toast-notification>

<!-- Confirm Dialog (Global) -->
<app-confirm-dialog
  [mostrar]="confirmService.mostrar"
  [titulo]="confirmService.opciones().title"
  [mensaje]="confirmService.opciones().message"
  [tipo]="confirmService.opciones().type || 'warning'"
  [textoConfirmar]="confirmService.opciones().confirmText || 'Confirmar'"
  [textoCancelar]="confirmService.opciones().cancelText || 'Cancelar'"
  [mostrarCancelar]="confirmService.opciones().showCancel !== false"
  (confirmar)="confirmService.onConfirmar()"
  (cancelar)="confirmService.onCancelar()"
  (cerrar)="confirmService.onCerrar()">
</app-confirm-dialog>
